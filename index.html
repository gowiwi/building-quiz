<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="pageTitle">å»ºç¯‰ç•ªä»˜ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-radius: 10px;
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .language-selector {
                top: 10px;
                right: 10px;
            }
        }

        .lang-btn {
            padding: 8px 15px;
            font-size: 0.9em;
            border-radius: 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .lang-btn.active {
            background: #3498db;
            color: white;
        }

        .lang-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .game-info {
                padding: 10px;
                margin-bottom: 15px;
            }
        }

        .question {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .question {
                font-size: 1.5em;
                padding: 12px;
                margin: 10px 0;
            }
        }

        .grid-container {
            display: inline-block;
            border: 3px solid #333;
            border-radius: 10px;
            overflow: auto;
            margin: 15px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 100%;
        }

        @media (max-width: 768px) {
            .grid-container {
                border: 2px solid #333;
                border-radius: 8px;
                margin: 10px auto;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        .grid {
            display: grid;
            grid-template-columns: 50px repeat(10, 60px);
            grid-template-rows: 50px repeat(10, 60px);
            gap: 1px;
            background: #ddd;
        }

        .cell {
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #eee;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        .header {
            background: #34495e;
            color: white;
            cursor: default;
            font-size: 1.2em;
        }

        @media (hover: hover) {
            .cell:not(.header):hover {
                background: #e3f2fd;
                transform: scale(1.05);
            }
        }

        .cell:not(.header):active {
            background: #e3f2fd;
            transform: scale(0.95);
        }

        .cell.correct {
            background: #4caf50 !important;
            color: white;
            animation: pulse 0.5s ease-in-out;
        }

        .cell.wrong {
            background: #f44336 !important;
            color: white;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .buttons {
            text-align: center;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .buttons {
                margin-top: 15px;
            }
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            button {
                padding: 12px 20px;
                font-size: 1em;
                margin: 5px;
            }
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .score {
            font-size: 1.2em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .score {
                font-size: 1em;
            }
        }

        .correct-score {
            color: #27ae60;
        }

        .wrong-score {
            color: #e74c3c;
        }

        .message {
            text-align: center;
            margin: 15px 0;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 30px;
        }

        @media (max-width: 768px) {
            .message {
                font-size: 1.1em;
                margin: 10px 0;
                min-height: 25px;
            }
        }

        .success {
            color: #27ae60;
        }

        .error {
            color: #e74c3c;
        }

        .instructions {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .instructions {
                padding: 12px;
                font-size: 0.9em;
                line-height: 1.5;
            }
        }

        .difficulty-timer {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            margin-bottom: 20px;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .difficulty-timer {
                flex-direction: column;
                gap: 10px;
            }
        }

        .difficulty-section, .timer-section {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            flex: 1;
        }

        @media (max-width: 768px) {
            .difficulty-section, .timer-section {
                padding: 10px;
            }
        }

        .difficulty-section h3, .timer-section h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            color: #333;
        }

        @media (max-width: 768px) {
            .difficulty-section h3, .timer-section h3 {
                font-size: 1em;
                margin-bottom: 8px;
            }
        }

        .difficulty-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 8px 15px;
            font-size: 0.9em;
            border-radius: 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .difficulty-btn {
                padding: 10px 12px;
                font-size: 0.85em;
            }
        }

        .difficulty-btn.active {
            background: #3498db;
            color: white;
        }

        .difficulty-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .timer-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            min-width: 100px;
        }

        @media (max-width: 768px) {
            .timer-display {
                font-size: 1.5em;
                padding: 8px;
                min-width: 80px;
            }
        }

        .timer-running {
            color: #e74c3c;
            border-color: #e74c3c;
            animation: timerPulse 1s infinite alternate;
        }

        @keyframes timerPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .timer-warning {
            color: #f39c12 !important;
            border-color: #f39c12 !important;
        }

        .timer-danger {
            color: #e74c3c !important;
            border-color: #e74c3c !important;
            animation: timerDanger 0.5s infinite alternate !important;
        }

        @keyframes timerDanger {
            0% { background: white; }
            100% { background: #ffebee; }
        }

        .difficulty-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- è¨€èªé¸æŠãƒœã‚¿ãƒ³ -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="switchLanguage('ja')">æ—¥æœ¬èª</button>
        <button class="lang-btn" onclick="switchLanguage('en')">English</button>
    </div>

    <div class="container">
        <h1 id="title">ğŸ—ï¸ å»ºç¯‰ç•ªä»˜ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ </h1>
        
        <div class="instructions" id="instructions">
            <strong>éŠã³æ–¹ï¼š</strong><br>
            è¡¨ç¤ºã•ã‚ŒãŸåº§æ¨™ï¼ˆä¾‹ï¼šã€Œã„3ã€ï¼‰ãŒã‚°ãƒªãƒƒãƒ‰ã®ã©ã“ã«ã‚ã‚‹ã‹ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
            æ¨ªè»¸ï¼šã„ã‚ã¯ã«ã»ã¸ã¨ã¡ã‚Šã¬ã‚‹ã‚’â€¦ï¼ˆã„ã‚ã¯æ­Œï¼‰<br>
            ç¸¦è»¸ï¼š1, 2, 3, 4, 5â€¦
        </div>

        <div class="difficulty-timer">
            <div class="difficulty-section">
                <h3 id="difficultyTitle">ğŸ¯ é›£æ˜“åº¦é¸æŠ</h3>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn active" onclick="setDifficulty('easy')" id="easyBtn">åˆç´š</button>
                    <button class="difficulty-btn" onclick="setDifficulty('normal')" id="normalBtn">ä¸­ç´š</button>
                    <button class="difficulty-btn" onclick="setDifficulty('hard')" id="hardBtn">ä¸Šç´š</button>
                    <button class="difficulty-btn" onclick="setDifficulty('expert')" id="expertBtn">è¶…ç´š</button>
                </div>
                <div class="difficulty-info" id="difficultyInfo">ã‚°ãƒªãƒƒãƒ‰: 10Ã—10, åˆ¶é™æ™‚é–“: ãªã—</div>
            </div>
            <div class="timer-section">
                <h3 id="timerTitle">â±ï¸ ã‚¿ã‚¤ãƒãƒ¼</h3>
                <div class="timer-display" id="timer">--:--</div>
            </div>
        </div>

        <div class="game-info">
            <div class="score">
                <span id="correctLabel">æ­£è§£</span>: <span class="correct-score" id="correct">0</span>
            </div>
            <div class="score">
                <span id="wrongLabel">ä¸æ­£è§£</span>: <span class="wrong-score" id="wrong">0</span>
            </div>
            <div class="score">
                <span id="rateLabel">æ­£è§£ç‡</span>: <span id="rate">0%</span>
            </div>
        </div>

        <div class="question" id="question">ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</div>
        
        <div style="text-align: center; margin: 10px 0;">
            <div style="display: inline-block; background: #3498db; color: white; padding: 10px 20px; border-radius: 20px; font-size: 1.2em; font-weight: bold;" id="questionCounter">
                -- / 10
            </div>
        </div>
        
        <div class="message" id="message"></div>

        <div style="text-align: center;">
            <div class="grid-container">
                <div class="grid" id="grid">
                    <!-- ã‚°ãƒªãƒƒãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="buttons">
            <button id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            <button id="nextBtn" onclick="nextQuestion()" style="display: none;">æ¬¡ã®å•é¡Œ</button>
            <button id="resetBtn" onclick="resetScore()">ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <!-- çµæœè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="resultModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; text-align: center;">
                <h2 id="gameCompleteTitle" style="color: #333; margin-bottom: 20px;">ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
                <div style="font-size: 1.5em; margin: 20px 0;">
                    <div style="color: #27ae60; margin: 10px 0;">âœ… <span id="finalCorrectLabel">æ­£è§£</span>: <span id="finalCorrect">0</span><span id="finalQuestionsLabel1">å•</span></div>
                    <div style="color: #e74c3c; margin: 10px 0;">âŒ <span id="finalWrongLabel">ä¸æ­£è§£</span>: <span id="finalWrong">0</span><span id="finalQuestionsLabel2">å•</span></div>
                    <div style="color: #f39c12; margin: 10px 0;">â±ï¸ <span id="totalTimeLabel">å®Œäº†æ™‚é–“</span>: <span id="totalTime">0</span><span id="secondsLabel">ç§’</span></div>
                    <div style="font-size: 2em; font-weight: bold; color: #3498db; margin: 20px 0;">
                        <span id="finalRateLabel">æ­£è§£ç‡</span>: <span id="finalRate">0</span>%
                    </div>
                </div>
                <div id="resultMessage" style="font-size: 1.3em; font-weight: bold; margin: 20px 0;"></div>
                <button id="closeBtn" onclick="closeResult()" style="background: #3498db; color: white; border: none; padding: 15px 30px; font-size: 1.2em; border-radius: 25px; cursor: pointer; margin: 10px;">é–‰ã˜ã‚‹</button>
                <button id="playAgainBtn" onclick="restartGame()" style="background: #27ae60; color: white; border: none; padding: 15px 30px; font-size: 1.2em; border-radius: 25px; cursor: pointer; margin: 10px;">ã‚‚ã†ä¸€åº¦</button>
            </div>
        </div>
    </div>

    <script>
        // ã„ã‚ã¯æ­Œã®æ–‡å­—ï¼ˆå®Œå…¨ç‰ˆï¼‰
        const irohaFull = ['ã„', 'ã‚', 'ã¯', 'ã«', 'ã»', 'ã¸', 'ã¨', 'ã¡', 'ã‚Š', 'ã¬', 'ã‚‹', 'ã‚’', 'ã‚', 'ã‹', 'ã‚ˆ', 'ãŸ', 'ã‚Œ', 'ã', 'ã¤', 'ã­'];
        
        // é›£æ˜“åº¦è¨­å®š
        const difficulties = {
            easy: { gridSize: 10, timeLimit: 0, name: 'åˆç´š' },
            normal: { gridSize: 15, timeLimit: 15, name: 'ä¸­ç´š' },
            hard: { gridSize: 20, timeLimit: 10, name: 'ä¸Šç´š' },
            expert: { gridSize: 20, timeLimit: 5, name: 'è¶…ç´š' }
        };
        
        let currentDifficulty = 'easy';
        let iroha = [];
        let numbers = [];
        let currentAnswer = null;
        let correctCount = 0;
        let wrongCount = 0;
        let isQuestionActive = false;
        let timer = null;
        let timeRemaining = 0;
        
        // 10å•ã‚»ãƒƒãƒˆç”¨ã®å¤‰æ•°
        let currentQuestionNumber = 0;
        let totalQuestions = 10;
        let gameActive = false;
        let sessionCorrect = 0;
        let sessionWrong = 0;
        let gameStartTime = 0;
        let totalGameTime = 0;
        
        // è¨€èªè¨­å®š
        let currentLanguage = 'ja';
        
        // å¤šè¨€èªå¯¾å¿œãƒ†ã‚­ã‚¹ãƒˆ
        const translations = {
            ja: {
                title: 'ğŸ—ï¸ å»ºç¯‰ç•ªä»˜ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ ',
                instructions: '<strong>éŠã³æ–¹ï¼š</strong><br>è¡¨ç¤ºã•ã‚ŒãŸåº§æ¨™ï¼ˆä¾‹ï¼šã€Œã„3ã€ï¼‰ãŒã‚°ãƒªãƒƒãƒ‰ã®ã©ã“ã«ã‚ã‚‹ã‹ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚<br>æ¨ªè»¸ï¼šã„ã‚ã¯ã«ã»ã¸ã¨ã¡ã‚Šã¬ã‚‹ã‚’â€¦ï¼ˆã„ã‚ã¯æ­Œï¼‰<br>ç¸¦è»¸ï¼š1, 2, 3, 4, 5â€¦',
                difficultyTitle: 'ğŸ¯ é›£æ˜“åº¦é¸æŠ',
                timerTitle: 'â±ï¸ ã‚¿ã‚¤ãƒãƒ¼',
                correct: 'æ­£è§£',
                wrong: 'ä¸æ­£è§£',
                rate: 'æ­£è§£ç‡',
                question: 'ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼',
                whereIs: 'ã¯ã©ã“ï¼Ÿ',
                startGame: 'ã‚²ãƒ¼ãƒ é–‹å§‹',
                nextQuestion: 'æ¬¡ã®å•é¡Œ',
                resetScore: 'ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ',
                gameComplete: 'ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼',
                totalTime: 'å®Œäº†æ™‚é–“',
                seconds: 'ç§’',
                questions: 'å•',
                close: 'é–‰ã˜ã‚‹',
                playAgain: 'ã‚‚ã†ä¸€åº¦',
                correctAnswer: 'âœ… æ­£è§£ã§ã™ï¼',
                wrongAnswer: 'âŒ ä¸æ­£è§£ã§ã™ã€‚æ­£è§£ã¯ã€Œ',
                wrongAnswerEnd: 'ã€ã§ã™ã€‚',
                timeUp: 'â° æ™‚é–“åˆ‡ã‚Œã§ã™ï¼æ­£è§£ã¯ã€Œ',
                timeUpEnd: 'ã€ã§ã—ãŸã€‚',
                startGameFirst: 'ã¾ãšã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼',
                easy: 'åˆç´š',
                normal: 'ä¸­ç´š',
                hard: 'ä¸Šç´š',
                expert: 'è¶…ç´š',
                easyInfo: 'ã‚°ãƒªãƒƒãƒ‰: 10Ã—10, åˆ¶é™æ™‚é–“: ãªã—',
                normalInfo: 'ã‚°ãƒªãƒƒãƒ‰: 15Ã—15, åˆ¶é™æ™‚é–“: 15ç§’',
                hardInfo: 'ã‚°ãƒªãƒƒãƒ‰: 20Ã—20, åˆ¶é™æ™‚é–“: 10ç§’',
                expertInfo: 'ã‚°ãƒªãƒƒãƒ‰: 20Ã—20, åˆ¶é™æ™‚é–“: 5ç§’',
                perfect: 'ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ç´ æ™´ã‚‰ã—ã„ï¼',
                great: 'ğŸŒŸ ã™ã”ã„ï¼ã‚ˆãã§ãã¾ã—ãŸï¼',
                good: 'ğŸ‘ ã„ã„æ„Ÿã˜ã§ã™ï¼',
                notBad: 'ğŸ’ª ã‚‚ã†å°‘ã—ï¼é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
                practice: 'ğŸ“š ç·´ç¿’ã‚ã‚‹ã®ã¿ï¼'
            },
            en: {
                title: 'ğŸ—ï¸ Construction Grid Quiz Game',
                instructions: '<strong>How to Play:</strong><br>Click on the grid cell matching the displayed coordinates (e.g., "ã„3").<br>Horizontal: Iroha characters (Japanese alphabet)<br>Vertical: 1, 2, 3, 4, 5â€¦',
                difficultyTitle: 'ğŸ¯ Difficulty',
                timerTitle: 'â±ï¸ Timer',
                correct: 'Correct',
                wrong: 'Wrong',
                rate: 'Accuracy',
                question: 'Click "Start Game" for 10-question challenge!',
                whereIs: ' - Where is it?',
                startGame: 'Start Game',
                nextQuestion: 'Next Question',
                resetScore: 'Reset Score',
                gameComplete: 'ğŸ‰ Game Complete!',
                totalTime: 'Total Time',
                seconds: 'sec',
                questions: ' questions',
                close: 'Close',
                playAgain: 'Play Again',
                correctAnswer: 'âœ… Correct!',
                wrongAnswer: 'âŒ Wrong. The answer is "',
                wrongAnswerEnd: '".',
                timeUp: 'â° Time\'s up! The answer was "',
                timeUpEnd: '".',
                startGameFirst: 'Please click "Start Game" first!',
                easy: 'Easy',
                normal: 'Normal',
                hard: 'Hard',
                expert: 'Expert',
                easyInfo: 'Grid: 10Ã—10, Time limit: None',
                normalInfo: 'Grid: 15Ã—15, Time limit: 15 sec',
                hardInfo: 'Grid: 20Ã—20, Time limit: 10 sec',
                expertInfo: 'Grid: 20Ã—20, Time limit: 5 sec',
                perfect: 'ğŸ† Perfect! Outstanding!',
                great: 'ğŸŒŸ Great! Well done!',
                good: 'ğŸ‘ Good job!',
                notBad: 'ğŸ’ª Not bad! Keep trying!',
                practice: 'ğŸ“š Practice makes perfect!'
            }
        };

        // è¨€èªåˆ‡ã‚Šæ›¿ãˆ
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAllTexts();
        }
        
        // å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
        function updateAllTexts() {
            const t = translations[currentLanguage];
            
            // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«
            document.getElementById('pageTitle').textContent = t.title.replace('ğŸ—ï¸ ', '');
            document.getElementById('title').textContent = t.title;
            document.getElementById('instructions').innerHTML = t.instructions;
            
            // é›£æ˜“åº¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³
            document.getElementById('difficultyTitle').textContent = t.difficultyTitle;
            document.getElementById('easyBtn').textContent = t.easy;
            document.getElementById('normalBtn').textContent = t.normal;
            document.getElementById('hardBtn').textContent = t.hard;
            document.getElementById('expertBtn').textContent = t.expert;
            
            // ã‚¿ã‚¤ãƒãƒ¼
            document.getElementById('timerTitle').textContent = t.timerTitle;
            
            // ã‚¹ã‚³ã‚¢ãƒ©ãƒ™ãƒ«
            document.getElementById('correctLabel').textContent = t.correct;
            document.getElementById('wrongLabel').textContent = t.wrong;
            document.getElementById('rateLabel').textContent = t.rate;
            
            // ãƒœã‚¿ãƒ³
            document.getElementById('startBtn').textContent = t.startGame;
            document.getElementById('nextBtn').textContent = t.nextQuestion;
            document.getElementById('resetBtn').textContent = t.resetScore;
            
            // çµæœãƒ¢ãƒ¼ãƒ€ãƒ«
            document.getElementById('gameCompleteTitle').textContent = t.gameComplete;
            document.getElementById('finalCorrectLabel').textContent = t.correct;
            document.getElementById('finalWrongLabel').textContent = t.wrong;
            document.getElementById('totalTimeLabel').textContent = t.totalTime;
            document.getElementById('secondsLabel').textContent = t.seconds;
            document.getElementById('finalRateLabel').textContent = t.rate;
            document.getElementById('finalQuestionsLabel1').textContent = t.questions;
            document.getElementById('finalQuestionsLabel2').textContent = t.questions;
            document.getElementById('closeBtn').textContent = t.close;
            document.getElementById('playAgainBtn').textContent = t.playAgain;
            
            // é›£æ˜“åº¦æƒ…å ±
            updateDifficultyInfo();
            
            // å•é¡Œãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚²ãƒ¼ãƒ ä¸­ã§ãªã„å ´åˆï¼‰
            if (!gameActive) {
                document.getElementById('question').textContent = t.question;
            }
        }
        
        // é›£æ˜“åº¦æƒ…å ±ã‚’æ›´æ–°
        function updateDifficultyInfo() {
            const t = translations[currentLanguage];
            const infoMap = {
                'easy': t.easyInfo,
                'normal': t.normalInfo,
                'hard': t.hardInfo,
                'expert': t.expertInfo
            };
            document.getElementById('difficultyInfo').textContent = infoMap[currentDifficulty];
        }

        // é›£æ˜“åº¦ã«å¿œã˜ã¦ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’æ›´æ–°
        function updateGridSettings() {
            const difficulty = difficulties[currentDifficulty];
            const gridSize = difficulty.gridSize;
            
            iroha = irohaFull.slice(0, gridSize);
            numbers = Array.from({length: gridSize}, (_, i) => i + 1);
            
            // ã‚°ãƒªãƒƒãƒ‰ã®CSSèª¿æ•´ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
            const grid = document.getElementById('grid');
            const isMobile = window.innerWidth <= 768;
            
            let cellSize, headerSize;
            if (isMobile) {
                cellSize = gridSize <= 10 ? 35 : gridSize <= 15 ? 28 : 22;
                headerSize = gridSize <= 10 ? 30 : gridSize <= 15 ? 25 : 22;
            } else {
                cellSize = gridSize <= 10 ? 60 : gridSize <= 15 ? 45 : 35;
                headerSize = gridSize <= 10 ? 50 : gridSize <= 15 ? 40 : 35;
            }
            
            grid.style.gridTemplateColumns = `${headerSize}px repeat(${gridSize}, ${cellSize}px)`;
            grid.style.gridTemplateRows = `${headerSize}px repeat(${gridSize}, ${cellSize}px)`;
        }

        // ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆ
        function createGrid() {
            updateGridSettings();
            
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            // å·¦ä¸Šã®ç©ºç™½ã‚»ãƒ«
            const emptyCell = document.createElement('div');
            emptyCell.className = 'cell header';
            grid.appendChild(emptyCell);

            // æ¨ªè»¸ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã„ã‚ã¯ï¼‰
            iroha.forEach(char => {
                const cell = document.createElement('div');
                cell.className = 'cell header';
                cell.textContent = char;
                grid.appendChild(cell);
            });

            // ç¸¦è»¸ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«
            numbers.forEach(num => {
                // ç¸¦è»¸ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ•°å­—ï¼‰
                const headerCell = document.createElement('div');
                headerCell.className = 'cell header';
                headerCell.textContent = num;
                grid.appendChild(headerCell);

                // ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«
                iroha.forEach((char, colIndex) => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = num;
                    cell.dataset.col = char;
                    cell.addEventListener('click', () => handleCellClick(char, num, cell));
                    grid.appendChild(cell);
                });
            });
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–¢é€£ã®é–¢æ•°
        function startTimer() {
            const difficulty = difficulties[currentDifficulty];
            if (difficulty.timeLimit === 0) return;
            
            timeRemaining = difficulty.timeLimit;
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    handleTimeUp();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }
        
        function updateTimerDisplay() {
            const timerElement = document.getElementById('timer');
            const difficulty = difficulties[currentDifficulty];
            
            if (difficulty.timeLimit === 0) {
                timerElement.textContent = '--:--';
                timerElement.className = 'timer-display';
                return;
            }
            
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // ã‚¿ã‚¤ãƒãƒ¼ã®è‰²ã‚’æ™‚é–“ã«å¿œã˜ã¦å¤‰æ›´
            timerElement.className = 'timer-display timer-running';
            if (timeRemaining <= difficulty.timeLimit * 0.3) {
                timerElement.classList.add('timer-danger');
            } else if (timeRemaining <= difficulty.timeLimit * 0.5) {
                timerElement.classList.add('timer-warning');
            }
        }
        
        function handleTimeUp() {
            if (!isQuestionActive) return;
            
            const t = translations[currentLanguage];
            
            wrongCount++;
            sessionWrong++;
            
            const timeUpMsg = currentLanguage === 'ja'
                ? t.timeUp + currentAnswer.col + currentAnswer.row + t.timeUpEnd
                : t.timeUp + currentAnswer.col + currentAnswer.row + t.timeUpEnd;
            
            document.getElementById('message').innerHTML = 
                '<span class="error">' + timeUpMsg + '</span>';
            
            // æ­£è§£ã®ã‚»ãƒ«ã‚’è¡¨ç¤º
            const correctCell = document.querySelector(
                `[data-col="${currentAnswer.col}"][data-row="${currentAnswer.row}"]`
            );
            if (correctCell) {
                correctCell.classList.add('correct');
            }
            
            updateScore();
            isQuestionActive = false;
            
            // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            if (gameActive) {
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').style.opacity = '1';
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            gameActive = true;
            currentQuestionNumber = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            gameStartTime = Date.now();
            
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            
            nextQuestion();
        }
        
        // æ¬¡ã®å•é¡Œã¸
        function nextQuestion() {
            if (currentQuestionNumber >= totalQuestions) {
                showResult();
                return;
            }
            
            if (isQuestionActive) {
                clearPreviousAnswer();
                stopTimer();
            }
            
            currentQuestionNumber++;
            updateQuestionCounter();

            const randomCol = iroha[Math.floor(Math.random() * iroha.length)];
            const randomRow = numbers[Math.floor(Math.random() * numbers.length)];
            
            currentAnswer = { col: randomCol, row: randomRow };
            
            const t = translations[currentLanguage];
            if (currentLanguage === 'ja') {
                document.getElementById('question').textContent = `ã€Œ${randomCol}${randomRow}ã€${t.whereIs}`;
            } else {
                document.getElementById('question').textContent = `"${randomCol}${randomRow}"${t.whereIs}`;
            }
            document.getElementById('message').textContent = '';
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').style.opacity = '0.5';
            
            isQuestionActive = true;
            startTimer();
        }
        
        // å•é¡Œç•ªå·ã‚’æ›´æ–°
        function updateQuestionCounter() {
            document.getElementById('questionCounter').textContent = `${currentQuestionNumber} / ${totalQuestions}`;
        }
        
        // çµæœè¡¨ç¤º
        function showResult() {
            gameActive = false;
            isQuestionActive = false;
            stopTimer();
            
            // å®Œäº†æ™‚é–“ã‚’è¨ˆç®—
            totalGameTime = Math.round((Date.now() - gameStartTime) / 1000);
            
            const rate = Math.round((sessionCorrect / totalQuestions) * 100);
            const t = translations[currentLanguage];
            
            document.getElementById('finalCorrect').textContent = sessionCorrect;
            document.getElementById('finalWrong').textContent = sessionWrong;
            document.getElementById('totalTime').textContent = totalGameTime;
            document.getElementById('finalRate').textContent = rate;
            
            // è©•ä¾¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            let message = '';
            if (rate === 100) {
                message = t.perfect;
            } else if (rate >= 80) {
                message = t.great;
            } else if (rate >= 60) {
                message = t.good;
            } else if (rate >= 40) {
                message = t.notBad;
            } else {
                message = t.practice;
            }
            document.getElementById('resultMessage').textContent = message;
            
            document.getElementById('resultModal').style.display = 'flex';
        }
        
        // çµæœã‚’é–‰ã˜ã‚‹
        function closeResult() {
            document.getElementById('resultModal').style.display = 'none';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            const t = translations[currentLanguage];
            document.getElementById('question').textContent = t.question;
            document.getElementById('questionCounter').textContent = '-- / 10';
            clearPreviousAnswer();
        }
        
        // ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
        function restartGame() {
            closeResult();
            startGame();
        }

        // ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ã®å‡¦ç†
        function handleCellClick(col, row, cellElement) {
            const t = translations[currentLanguage];
            
            if (!isQuestionActive) {
                document.getElementById('message').innerHTML = 
                    '<span class="error">' + t.startGameFirst + '</span>';
                return;
            }

            stopTimer();
            clearPreviousAnswer();

            if (col === currentAnswer.col && row === currentAnswer.row) {
                // æ­£è§£
                cellElement.classList.add('correct');
                correctCount++;
                sessionCorrect++;
                const difficulty = difficulties[currentDifficulty];
                let message = t.correctAnswer;
                if (difficulty.timeLimit > 0) {
                    const timeTaken = difficulty.timeLimit - timeRemaining;
                    message += ` (${timeTaken}${t.seconds})`;
                }
                document.getElementById('message').innerHTML = 
                    '<span class="success">' + message + '</span>';
            } else {
                // ä¸æ­£è§£
                cellElement.classList.add('wrong');
                wrongCount++;
                sessionWrong++;
                
                const wrongMsg = currentLanguage === 'ja' 
                    ? t.wrongAnswer + currentAnswer.col + currentAnswer.row + t.wrongAnswerEnd
                    : t.wrongAnswer + currentAnswer.col + currentAnswer.row + t.wrongAnswerEnd;
                
                document.getElementById('message').innerHTML = 
                    '<span class="error">' + wrongMsg + '</span>';
                
                // æ­£è§£ã®ã‚»ãƒ«ã‚‚è¡¨ç¤º
                const correctCell = document.querySelector(
                    `[data-col="${currentAnswer.col}"][data-row="${currentAnswer.row}"]`
                );
                if (correctCell) {
                    setTimeout(() => {
                        correctCell.classList.add('correct');
                    }, 500);
                }
            }

            updateScore();
            isQuestionActive = false;
            
            // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            if (gameActive) {
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('nextBtn').style.opacity = '1';
            }
        }

        // å‰ã®å›ç­”ã‚’ã‚¯ãƒªã‚¢
        function clearPreviousAnswer() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('correct', 'wrong');
            });
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateScore() {
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('wrong').textContent = wrongCount;
            
            const total = correctCount + wrongCount;
            const rate = total > 0 ? Math.round((correctCount / total) * 100) : 0;
            document.getElementById('rate').textContent = rate + '%';
        }

        // é›£æ˜“åº¦è¨­å®š
        function setDifficulty(level) {
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœã‚¿ãƒ³ã®æ›´æ–°
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentDifficulty = level;
            
            // é›£æ˜“åº¦æƒ…å ±ã®æ›´æ–°
            updateDifficultyInfo();
            
            // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            resetScore();
            createGrid();
        }

        // ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ
        function resetScore() {
            correctCount = 0;
            wrongCount = 0;
            isQuestionActive = false;
            gameActive = false;
            currentQuestionNumber = 0;
            sessionCorrect = 0;
            sessionWrong = 0;
            gameStartTime = 0;
            totalGameTime = 0;
            stopTimer();
            updateScore();
            clearPreviousAnswer();
            
            const t = translations[currentLanguage];
            document.getElementById('question').textContent = t.question;
            document.getElementById('message').textContent = '';
            document.getElementById('questionCounter').textContent = '-- / 10';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            
            // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ
            const timerElement = document.getElementById('timer');
            timerElement.textContent = '--:--';
            timerElement.className = 'timer-display';
        }

        // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å¯¾å¿œ
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (!isQuestionActive) {
                    createGrid();
                }
            }, 250);
        });

        // åˆæœŸåŒ–
        window.onload = function() {
            createGrid();
            updateScore();
        };
    </script>
</body>
</html>
